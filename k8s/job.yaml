apiVersion: batch/v1
kind: Job
metadata:
  name: treasure-job              # <- required by Harness; keep static
  labels:
    app: treasure
spec:
  backoffLimit: 0
  ttlSecondsAfterFinished: 300
  activeDeadlineSeconds: 300
  template:
    metadata:
      labels:
        app: treasure
    spec:
      restartPolicy: Never
      containers:
        - name: treasure
          image: "lutherstark/harness-ci-demo-treasure:latest"
          imagePullPolicy: IfNotPresent
          command: ["python", "-c"]
          args:
            - |
              import os
              print(r'''
              *******************************************************************************
              ... (ASCII art unchanged) ...
              *******************************************************************************
              ''')
              print("Welcome to Treasure Island.")
              print("Your mission is to find the treasure.")
              crossroad = os.getenv("CROSSROAD", "left").lower()
              if crossroad == "right":
                  print("You fell into the hole! You are dead!")
                  raise SystemExit(0)
              print("Good choice. you are moving on.")
              lake = os.getenv("LAKE", "wait").lower()
              if lake != "wait":
                  print("Ops!! An aligator just ate you. You are dead!")
                  raise SystemExit(0)
              print("Good choice, you are not fish food!")
              door = os.getenv("DOOR", "yellow").lower()
              if door == "red":
                  print("You just got burned by fire. You are dead!")
              elif door == "blue":
                  print("Sorry, there was a bear here and you just got eaten!!.")
              elif door == "yellow":
                  print("You found the treasure!!! You are the winner!")
              else:
                  print("Should have picked the right door! Game Over!")
          env:
            - name: CROSSROAD
              value: "<+pipeline.variables.CROSSROAD>"
            - name: LAKE
              value: "<+pipeline.variables.LAKE>"
            - name: DOOR
              value: "<+pipeline.variables.DOOR>"