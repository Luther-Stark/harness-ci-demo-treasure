apiVersion: batch/v1
kind: Job
metadata:
  name: treasure-job
  labels:
    app: treasure
spec:
  backoffLimit: 0
  template:
    metadata:
      labels:
        app: treasure
    spec:
      restartPolicy: Never
      containers:
        - name: treasure
          image: "<+artifact.image>"       # Harness replaces this with the built image
          imagePullPolicy: IfNotPresent
          command: ["python", "-c"]
          args:
            - |
              import os
              print(r'''
              *******************************************************************************
                        |                   |                  |                     |
               _________|________________.=""_;=.______________|_____________________|_______
              |                   |  ,-"_,=""     `"=.|                  |
              |___________________|__"=._o`"-._        `"=.______________|___________________
                        |                `"=._o`"=._      _`"=._                     |
               _________|_____________________:=._o "=._."_.-="'"=.__________________|_______
              |                   |    __.--" , ; `"=._o." ,-"""-._ ".   |
              |___________________|_._"  ,. .` ` `` ,  `"-._"-._   ". '__|___________________
                        |           |o`"=._` , "` `; .". ,  "-._"-._; ;              |
               _________|___________| ;`-.o`"=._; ." ` '`."\ ` . "-._ /_______________|_______
              |                   | |o ;    `"-.o`"=._``  '` " ,__.--o;   |
              |___________________|_| ;     (#) `-.o `"=.`_.--"_o.-; ;___|___________________
              ____/______/______/___|o;._    "      `".o|o_.--"    ;o;____/______/______/____
              /______/______/______/_"=._o--._        ; | ;        ; ;/______/______/______/_
              ____/______/______/______/__"=._o--._   ;o|o;     _._;o;____/______/______/____
              /______/______/______/______/____"=._o._; | ;_.--"o.--"_/______/______/______/_
              ____/______/______/______/_____"=.o|o_.--""___/______/______/______/______/____
              /______/______/______/______/______/______/______/______/______/______/_____ /
              *******************************************************************************
              ''')
              print("Welcome to Treasure Island.")
              print("Your mission is to find the treasure.")

              crossroad = os.getenv("CROSSROAD", "left").lower()
              if crossroad == "right":
                  print("You fell into the hole! You are dead!")
                  raise SystemExit(0)

              print("Good choice. you are moving on.")
              lake = os.getenv("LAKE", "wait").lower()
              if lake != "wait":
                  print("Ops!! An aligator just ate you. You are dead!")
                  raise SystemExit(0)

              print("Good choice, you are not fish food!")
              door = os.getenv("DOOR", "yellow").lower()
              if door == "red":
                  print("You just got burned by fire. You are dead!")
              elif door == "blue":
                  print("Sorry, there was a bear here and you just got eaten!!.")
              elif door == "yellow":
                  print("You found the treasure!!! You are the winner!")
              else:
                  print("Should have picked the right door! Game Over!")

          env:
            - name: CROSSROAD
              value: "<+pipeline.variables.CROSSROAD>"
            - name: LAKE
              value: "<+pipeline.variables.LAKE>"
            - name: DOOR
              value: "<+pipeline.variables.DOOR>"